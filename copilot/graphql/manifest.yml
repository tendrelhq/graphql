# The manifest for the "graphql" service.
# Read the full specification for the "Request-Driven Web Service" type at:
# https://aws.github.io/copilot-cli/docs/manifest/rd-web-service/

# Your service name will be used in naming your resources like log groups, App Runner services, etc.
name: graphql
# The "architecture" of the service you're running.
type: Request-Driven Web Service

image:
  # Docker build arguments.
  # For additional overrides: https://aws.github.io/copilot-cli/docs/manifest/rd-web-service/#image-build
  build: Dockerfile
  # Port exposed through your container to route traffic to it.
  port: 4000

http:
  path: /v1 # gql.tendrel.io/v1

# Number of CPU units for the task.
cpu: 1024
# Amount of memory in MiB used by the task.
memory: 2048

secrets:
  DB_USERNAME:
    secretsmanager: "/database/role/admin:username::"
  DB_PASSWORD:
    secretsmanager: "/database/role/admin:password::"
  DB_HOST:
    secretsmanager: "/database/role/admin:host::"
  DB_PORT:
    secretsmanager: "/database/role/admin:port::"
  DB_NAME:
    secretsmanager: "/database/role/admin:dbname::"

# You can override any of the values defined above by environment.
environments:
  dev:
    secrets:
      DB_USERNAME:
        secretsmanager: "/database/role/admin:username::"
      DB_PASSWORD:
        secretsmanager: "/database/role/admin:password::"
      DB_HOST:
        secretsmanager: "/database/role/admin:host::"
      DB_PORT:
        secretsmanager: "/database/role/admin:port::"
      DB_NAME:
        secretsmanager: "/database/role/admin:dbname::"
    variables:
      LOG_LEVEL: debug
      NODE_ENV: development
  test:
    secrets:
      DB_USERNAME:
        secretsmanager: "/database/service/graphql:username::"
      DB_PASSWORD:
        secretsmanager: "/database/service/graphql:password::"
      DB_HOST:
        secretsmanager: "/database/service/graphql:host::"
      DB_PORT:
        secretsmanager: "/database/service/graphql:port::"
      DB_NAME:
        secretsmanager: "/database/service/graphql:dbname::"
    variables:
      LOG_LEVEL: debug
