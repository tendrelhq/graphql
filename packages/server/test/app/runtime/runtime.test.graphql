query TestRuntimeEntrypoint(
  $count: Int
  $parent: ID!
  $impl: String
  $includeHashes: Boolean! = false
  $includeInactive: Boolean! = false
  $includeTrackingIds: Boolean! = false
  $includeTransitionIds: Boolean! = false
) {
  trackables(
    first: $count
    parent: $parent
    includeInactive: $includeInactive
    withImplementation: $impl
  ) {
    edges {
      node {
        id @include(if: $includeTrackingIds)
        ... on Location {
          name {
            value
          }
        }
        ... on Task {
          displayName: name {
            value
          }
          hash
          parent {
            ... on Location {
              name {
                value
              }
            }
          }
          state {
            __typename
            ... on Open {
              openedBy {
                ... on Worker {
                  displayName
                }
              }
            }
            ... on InProgress {
              inProgressBy {
                ... on Worker {
                  displayName
                }
              }
            }
            ... on Closed {
              closedBy {
                ... on Worker {
                  displayName
                }
              }
            }
          }
        }
        ...Trackables_fragment
      }
    }
    totalCount
  }
}

query TestRuntimeDetail(
  $node: ID!
  $overTypes: [String!] = ["Runtime", "Idle Time", "Downtime"]
  $includeChainParents: Boolean! = false
) {
  node(id: $node) {
    ... on Task {
      # "matrix" component
      chainAgg(overType: $overTypes) {
        group
        value
      }
      # "run output" and "reject count" components
      outputs: field(byName: "Run Output") {
        name {
          value
        }
        value {
          ... on NumberValue {
            number
          }
        }
      }
      rejects: field(byName: "Reject Count") {
        name {
          value
        }
        value {
          ... on NumberValue {
            number
          }
        }
      }
      # "timeline" component
      chain {
        ...TaskChain_fragment
      }
      children {
        ...TaskChain_fragment
      }
      parent {
        ... on Location {
          name {
            value
          }
        }
      }
    }
  }
}

mutation TestRuntimeTransitionMutation(
  $opts: AdvanceFsmOptions!
  $includeChain: Boolean! = false
  $includeHashes: Boolean! = false
  $includeRoot: Boolean! = true
  $includeTransitionIds: Boolean! = false
) {
  advance(opts: $opts) {
    diagnostics {
      code
    }
    root @include(if: $includeRoot) {
      chain @include(if: $includeChain) {
        edges {
          node {
            name {
              value
            }
            state {
              __typename
              ... on Open {
                openedBy {
                  ... on Worker {
                    displayName
                  }
                }
              }
              ... on InProgress {
                inProgressBy {
                  ... on Worker {
                    displayName
                  }
                }
              }
              ... on Closed {
                closedBy {
                  ... on Worker {
                    displayName
                  }
                }
              }
            }
          }
        }
      }
      id @include(if: $includeTransitionIds)
      hash @include(if: $includeHashes)
      fsm {
        ...TaskFSM_fragment
      }
      state {
        __typename
        ... on Open {
          openedBy {
            ... on Worker {
              displayName
            }
          }
        }
        ... on InProgress {
          inProgressBy {
            ... on Worker {
              displayName
            }
          }
        }
        ... on Closed {
          closedBy {
            ... on Worker {
              displayName
            }
          }
        }
      }
    }
    instantiations {
      node {
        chain {
          totalCount
        }
        name {
          value
        }
        parent {
          ... on Location {
            name {
              value
            }
          }
        }
        state {
          __typename
        }
      }
    }
  }
}

mutation TestRuntimeApplyFieldEditsMutation(
  $entity: ID!
  $edits: [FieldInput!]!
) {
  applyFieldEdits(entity: $entity, edits: $edits) {
    fields {
      edges {
        node {
          name {
            value
          }
          value {
            __typename
            ... on StringValue {
              string
            }
            ... on TimestampValue {
              timestamp
            }
          }
          valueType
        }
      }
    }
  }
}

fragment Trackables_fragment on Trackable {
  tracking {
    edges {
      node {
        __typename
        ... on Task {
          id @include(if: $includeTransitionIds)
          fsm {
            ...TaskFSM_fragment
          }
          hash @include(if: $includeHashes)
          name {
            value
          }
          parent {
            ... on Location {
              name {
                value
              }
            }
          }
          root {
            id @include(if: $includeTransitionIds)
            hash @include(if: $includeHashes)
            name {
              value
            }
            parent {
              ... on Location {
                name {
                  value
                }
              }
            }
          }
          state {
            __typename
          }
          types
        }
      }
    }
  }
}

fragment TaskFSM_fragment on TaskStateMachine {
  active {
    assignees {
      edges {
        node {
          assignedTo {
            ... on Worker {
              displayName
            }
          }
        }
      }
    }
    description {
      value
    }
    hash @include(if: $includeHashes)
    id @include(if: $includeTransitionIds)
    name {
      value
    }
    fields {
      edges {
        node {
          description {
            value
          }
          name {
            value
          }
          value {
            __typename
            ... on StringValue {
              string
            }
            ... on TimestampValue {
              timestamp
            }
          }
          valueType
        }
      }
    }
    parent {
      ... on Location {
        name {
          value
        }
      }
    }
    state {
      __typename
      ... on Open {
        openedBy {
          ... on Worker {
            displayName
          }
        }
      }
      ... on InProgress {
        inProgressBy {
          ... on Worker {
            displayName
          }
        }
      }
      ... on Closed {
        closedBy {
          ... on Worker {
            displayName
          }
        }
      }
    }
    types
  }
  transitions {
    edges {
      id @include(if: $includeTransitionIds)
      node {
        id @include(if: $includeTransitionIds)
        hash @include(if: $includeHashes)
        name {
          value
        }
        fields {
          edges {
            node {
              name {
                value
              }
              value {
                __typename
              }
            }
          }
        }
      }
      target {
        name {
          value
        }
      }
    }
  }
}

fragment TaskChain_fragment on TaskConnection {
  edges {
    node {
      name {
        value
      }
      parent @include(if: $includeChainParents) {
        ... on Location {
          name {
            value
          }
        }
      }
      state {
        __typename
        ... on InProgress {
          inProgressBy {
            ... on Worker {
              displayName
            }
          }
        }
        ... on Closed {
          closedBy {
            ... on Worker {
              displayName
            }
          }
        }
      }
    }
  }
  totalCount
}
