query TestBatchEntrypoint($parent: ID!, $includeTrackingIds: Boolean! = false) {
  trackables(parent: $parent, withImplementation: "Batch") {
    edges {
      node {
        ... on Task {
          id @include(if: $includeTrackingIds)
          hash
          name {
            value # Batch id/name/number (user defined)
          }
          fields {
            edges {
              node {
                name {
                  value
                }
              }
            }
          }
          chain {
            edges {
              node {
                name {
                  value
                }
                state {
                  __typename
                }
              }
            }
          }
          chainAgg(overType: ["Batch", "Runtime", "Downtime", "Idle Time"]) {
            group
            value
          }
          fsm {
            active {
              id
              hash
              name {
                value
              }
              parent {
                ... on Location {
                  name {
                    value
                  }
                }
              }
              state {
                __typename
              }
              types
            }
            transitions {
              edges {
                # id # This is what you should pass to `advance()`
                node {
                  # The (next) work template, same as before.
                  name {
                    value
                  }
                }
                target {
                  # The target Location, if any
                  name {
                    value
                  }
                }
              }
            }
          }
          state {
            __typename
          }
        }
      }
    }
  }
}

query TestListBatchTemplates($owner: ID!) {
  owner: node(id: $owner) {
    ... on Organization {
      locations(search: { isSite: true }) {
        edges {
          node {
            id
          }
        }
      }
    }
  }
  templates(owner: $owner, type: ["Batch"]) {
    edges {
      node {
        asTask {
          id
          customer: field(byName: "Customer") {
            ...FieldInput_fragment
          }
          productName: field(byName: "Product Name") {
            ...FieldInput_fragment
          }
          sku: field(byName: "SKU") {
            ...FieldInput_fragment
          }
        }
      }
    }
  }
}

fragment FieldInput_fragment on Field {
  id
}

mutation CreateBatchMutation(
  $batchTemplateId: ID!
  $batchId: String!
  $fields: [FieldInput!]!
  $location: ID!
) {
  createInstance(
    template: $batchTemplateId
    location: $location
    name: $batchId
    fields: $fields
  ) {
    edge {
      node {
        asTask {
          name {
            value
          }
          parent {
            ... on Location {
              name {
                value
              }
            }
          }
          state {
            __typename
          }
        }
      }
    }
  }
}

mutation AssignBatchMutation($node: ID!, $base: ID!, $parent: ID) {
  rebase(node: $node, base: $base, parent: $parent) {
    name {
      value
    }
    parent {
      ... on Location {
        name {
          value
        }
      }
    }
    root {
      name {
        value
      }
    }
    state {
      __typename
    }
  }
}

query TestHistoryQuery($parent: ID!) {
  trackables(
    parent: $parent
    withImplementation: "Task"
    onlyRoots: false
    type: ["Runtime"]
  ) {
    edges {
      node {
        ... on Task {
          name {
            value
          }
          parent {
            ... on Location {
              name {
                value
              }
            }
          }
          root {
            name {
              value
            }
            state {
              __typename
            }
          }
          state {
            __typename
          }
        }
      }
    }
  }
}
